<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Ä–µ–Ω–¥–∞–º–∏ - CarRental</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .status-pending { background-color: #fff3cd; }
        .status-confirmed { background-color: #d1ecf1; }
        .status-active { background-color: #d4edda; }
        .status-completed { background-color: #e2e3e5; }
        .status-rejected { background-color: #f8d7da; }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/manager/dashboard">üöó CarRental - –ú–µ–Ω–µ–¥–∂–µ—Ä</a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" href="/manager/dashboard">–î–∞—à–±–æ—Ä–¥</a>
            <a class="nav-link" href="/manager/cars">–ê–≤—Ç–æ–º–æ–±–∏–ª–∏</a>
            <a class="nav-link active" href="/manager/rentals">–ê—Ä–µ–Ω–¥—ã</a>
            <a class="nav-link" href="/logout">–í—ã–π—Ç–∏</a>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Ä–µ–Ω–¥–∞–º–∏</h2>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    <div th:if="${success}" class="alert alert-success">
        <span th:text="${success}"></span>
    </div>
    <div th:if="${error}" class="alert alert-danger">
        <span th:text="${error}"></span>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class="card mb-4">
        <div class="card-header">
            <h5>–§–∏–ª—å—Ç—Ä—ã</h5>
        </div>
        <div class="card-body">
            <div class="btn-group" role="group">
                <a href="/manager/rentals" class="btn btn-outline-primary">–í—Å–µ</a>
                <a href="/manager/rentals?status=PENDING" class="btn btn-outline-warning">–û–∂–∏–¥–∞—é—Ç (<span th:text="${pendingRentals.size()}">0</span>)</a>
                <a href="/manager/rentals?status=ACTIVE,CONFIRMED" class="btn btn-outline-success">–ê–∫—Ç–∏–≤–Ω—ã–µ (<span th:text="${activeRentals.size()}">0</span>)</a>
                <a href="/manager/rentals?status=COMPLETED" class="btn btn-outline-secondary">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</a>
            </div>
        </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –∞—Ä–µ–Ω–¥ -->
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5>–°–ø–∏—Å–æ–∫ –∞—Ä–µ–Ω–¥</h5>
            <span class="badge bg-primary" th:text="'–í—Å–µ–≥–æ: ' + ${allRentals.size()}"></span>
        </div>
        <div class="card-body">
            <div th:if="${allRentals.empty}" class="text-center text-muted py-4">
                <h5>–ù–µ—Ç –∞—Ä–µ–Ω–¥</h5>
                <p>–ê—Ä–µ–Ω–¥—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å, –∫–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç—ã –∑–∞–±—Ä–æ–Ω–∏—Ä—É—é—Ç –≤–∞—à–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏</p>
            </div>

            <div th:each="rental : ${allRentals}" class="border rounded mb-3 p-3" th:classappend="'status-' + ${rental.status.toString().toLowerCase()}">
                <div class="row align-items-center">
                    <div class="col-md-3">
                        <strong th:text="${rental.car.brand + ' ' + rental.car.model}"></strong>
                        <br>
                        <small class="text-muted" th:text="${rental.car.year + ' –≥–æ–¥'}"></small>
                    </div>
                    <div class="col-md-2">
                        <strong>–ö–ª–∏–µ–Ω—Ç:</strong>
                        <br>
                        <span th:text="${rental.user.fullName}"></span>
                    </div>
                    <div class="col-md-3">
                        <strong>–î–∞—Ç—ã –∞—Ä–µ–Ω–¥—ã:</strong>
                        <br>
                        <span th:text="${#temporals.format(rental.startDate, 'dd.MM.yyyy HH:mm')}"></span> -
                        <span th:text="${#temporals.format(rental.endDate, 'dd.MM.yyyy HH:mm')}"></span>
                    </div>
                    <div class="col-md-2">
                        <strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong>
                        <br>
                        <span th:text="${#numbers.formatDecimal(rental.totalPrice, 0, 'DEFAULT', 2, 'DEFAULT')} + ' ‚ÇΩ'"></span>
                    </div>
                    <div class="col-md-2 text-end">
                            <span class="badge" th:classappend="{
                                'bg-warning': ${rental.status == T(org.example.carrental.entity.RentalStatus).PENDING},
                                'bg-info': ${rental.status == T(org.example.carrental.entity.RentalStatus).CONFIRMED},
                                'bg-success': ${rental.status == T(org.example.carrental.entity.RentalStatus).ACTIVE},
                                'bg-secondary': ${rental.status == T(org.example.carrental.entity.RentalStatus).COMPLETED},
                                'bg-danger': ${rental.status == T(org.example.carrental.entity.RentalStatus).REJECTED}
                            }" th:text="${rental.status}"></span>
                        <br>
                        <a th:href="@{/manager/rentals/{id}(id=${rental.id})}" class="btn btn-sm btn-outline-primary mt-1">–£–ø—Ä–∞–≤–ª—è—Ç—å</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>