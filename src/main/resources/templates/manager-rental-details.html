<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–î–µ—Ç–∞–ª–∏ –∞—Ä–µ–Ω–¥—ã - CarRental</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/manager/dashboard">üöó CarRental - –ú–µ–Ω–µ–¥–∂–µ—Ä</a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" href="/manager/dashboard">–î–∞—à–±–æ—Ä–¥</a>
            <a class="nav-link" href="/manager/rentals">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
            <a class="nav-link" href="/logout">–í—ã–π—Ç–∏</a>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <h2>–î–µ—Ç–∞–ª–∏ –∞—Ä–µ–Ω–¥—ã #<span th:text="${rental.id}"></span></h2>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    <div th:if="${success}" class="alert alert-success">
        <span th:text="${success}"></span>
    </div>
    <div th:if="${error}" class="alert alert-danger">
        <span th:text="${error}"></span>
    </div>

    <div class="row">
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞—Ä–µ–Ω–¥–µ -->
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h5>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞—Ä–µ–Ω–¥–µ</h5>
                </div>
                <div class="card-body">
                    <table class="table table-borderless">
                        <tr>
                            <td><strong>–°—Ç–∞—Ç—É—Å:</strong></td>
                            <td>
                                    <span class="badge" th:classappend="{
                                        'bg-warning': ${rental.status == T(org.example.carrental.entity.RentalStatus).PENDING},
                                        'bg-info': ${rental.status == T(org.example.carrental.entity.RentalStatus).CONFIRMED},
                                        'bg-success': ${rental.status == T(org.example.carrental.entity.RentalStatus).ACTIVE},
                                        'bg-secondary': ${rental.status == T(org.example.carrental.entity.RentalStatus).COMPLETED},
                                        'bg-danger': ${rental.status == T(org.example.carrental.entity.RentalStatus).REJECTED}
                                    }" th:text="${rental.status}"></span>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</strong></td>
                            <td th:text="${#temporals.format(rental.createdAt, 'dd.MM.yyyy HH:mm')}"></td>
                        </tr>
                        <tr>
                            <td><strong>–ü–ª–∞–Ω–æ–≤—ã–µ –¥–∞—Ç—ã:</strong></td>
                            <td th:text="${#temporals.format(rental.startDate, 'dd.MM.yyyy HH:mm')} + ' - ' + ${#temporals.format(rental.endDate, 'dd.MM.yyyy HH:mm')}"></td>
                        </tr>
                        <tr th:if="${rental.actualStartDate}">
                            <td><strong>–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∞–ª–æ:</strong></td>
                            <td th:text="${#temporals.format(rental.actualStartDate, 'dd.MM.yyyy HH:mm')}"></td>
                        </tr>
                        <tr th:if="${rental.actualEndDate}">
                            <td><strong>–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –æ–∫–æ–Ω—á–∞–Ω–∏–µ:</strong></td>
                            <td th:text="${#temporals.format(rental.actualEndDate, 'dd.MM.yyyy HH:mm')}"></td>
                        </tr>
                        <tr>
                            <td><strong>–ü–ª–∞–Ω–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</strong></td>
                            <td th:text="${#numbers.formatDecimal(rental.totalPrice, 0, 'DEFAULT', 2, 'DEFAULT')} + ' ‚ÇΩ'"></td>
                        </tr>
                        <tr th:if="${rental.actualPrice}">
                            <td><strong>–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</strong></td>
                            <td th:text="${#numbers.formatDecimal(rental.actualPrice, 0, 'DEFAULT', 2, 'DEFAULT')} + ' ‚ÇΩ'"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≤—Ç–æ–º–æ–±–∏–ª–µ –∏ –∫–ª–∏–µ–Ω—Ç–µ -->
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h5>–ê–≤—Ç–æ–º–æ–±–∏–ª—å</h5>
                </div>
                <div class="card-body">
                    <strong th:text="${rental.car.brand + ' ' + rental.car.model}"></strong>
                    <br>
                    <span th:text="${rental.car.year + ' –≥–æ–¥, ' + rental.car.color}"></span>
                    <br>
                    <span th:text="${rental.car.fuelType + ', ' + rental.car.transmission}"></span>
                    <br>
                    <span class="text-success" th:text="${#numbers.formatDecimal(rental.car.pricePerDay, 0, 'DEFAULT', 2, 'DEFAULT')} + ' ‚ÇΩ/–¥–µ–Ω—å'"></span>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h5>–ö–ª–∏–µ–Ω—Ç</h5>
                </div>
                <div class="card-body">
                    <strong th:text="${rental.user.fullName}"></strong>
                    <br>
                    <span th:text="'–¢–µ–ª–µ—Ñ–æ–Ω: ' + ${rental.user.phone}"></span>
                    <br>
                    <span th:text="'Email: ' + ${rental.user.email}"></span>
                    <br>
                    <span th:if="${rental.user.driverLicense}" th:text="'–ü—Ä–∞–≤–∞: ' + ${rental.user.driverLicense}"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- –î–µ–π—Å—Ç–≤–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ -->
    <div class="card">
        <div class="card-header">
            <h5>–î–µ–π—Å—Ç–≤–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞</h5>
        </div>
        <div class="card-body">
            <div th:if="${rental.status == T(org.example.carrental.entity.RentalStatus).PENDING}">
                <form th:action="@{/manager/rentals/{id}/approve(id=${rental.id})}" method="post" class="d-inline">
                    <button type="submit" class="btn btn-success me-2">‚úÖ –û–¥–æ–±—Ä–∏—Ç—å –∞—Ä–µ–Ω–¥—É</button>
                </form>
                <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#rejectModal">
                    ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å –∞—Ä–µ–Ω–¥—É
                </button>
            </div>

            <div th:if="${rental.status == T(org.example.carrental.entity.RentalStatus).CONFIRMED}">
                <form th:action="@{/manager/rentals/{id}/complete(id=${rental.id})}" method="post" class="d-inline">
                    <button type="submit" class="btn btn-primary">üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å –∞—Ä–µ–Ω–¥—É</button>
                </form>
            </div>

            <div th:if="${rental.status == T(org.example.carrental.entity.RentalStatus).ACTIVE}">
                <form th:action="@{/manager/rentals/{id}/complete(id=${rental.id})}" method="post" class="d-inline">
                    <button type="submit" class="btn btn-primary">üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å –∞—Ä–µ–Ω–¥—É</button>
                </form>
            </div>

            <div th:if="${rental.status == T(org.example.carrental.entity.RentalStatus).COMPLETED}">
                <span class="text-success">‚úÖ –ê—Ä–µ–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</span>
            </div>

            <div th:if="${rental.status == T(org.example.carrental.entity.RentalStatus).REJECTED}">
                <span class="text-danger">‚ùå –ê—Ä–µ–Ω–¥–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞</span>
                <div th:if="${rental.rejectionReason}">
                    <strong>–ü—Ä–∏—á–∏–Ω–∞:</strong> <span th:text="${rental.rejectionReason}"></span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è -->
<div class="modal fade" id="rejectModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form th:action="@{/manager/rentals/{id}/reject(id=${rental.id})}" method="post">
                <div class="modal-header">
                    <h5 class="modal-title">–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∞—Ä–µ–Ω–¥—ã</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
                        <textarea name="reason" class="form-control" rows="3" placeholder="–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-danger">–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∞—Ä–µ–Ω–¥—É</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>